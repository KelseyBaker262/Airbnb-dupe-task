__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getExploreIsLeanTreatmentFlag=function(){return!1}}),"0d1817",[]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;function t(){const n=r(d[1]);return t=function(){return n},n}Object.defineProperty(e,"__esModule",{value:!0}),e.ClientNormalizeSearchPaths=function({redirectUrl:n}){const c=(0,p.useLocation)();return n=n??_(c),(0,s.useEffect)((()=>{if(null!=n){const s=(0,t().parsePath)(n);(0,f.replaceToHistory)(s.pathname,{params:(0,E.default)(s.search)})}}),[n]),null},e.getRedirectUrl=_;var s=r(d[2]),c=r(d[3]),l=r(d[4]),o=r(d[5]),u=r(d[6]),E=n(r(d[7])),f=r(d[8]),p=r(d[9]),h=n(r(d[10]));function S(n){return n.replace(/^\/s\/[^/]+\/(homes|experiences)/,'/s/:location/$1')}function _(n){const t=(0,c.selectFiltersFromURL)({pathname:n.pathname,queryString:n.search}),s=(t||{}).refinement_paths,f=(0,l.getTabFromRefinementPaths)(s),p={tabId:f,basePath:u.SEARCH_ENDPOINT};let _=n.search;const R=(0,E.default)(_),O=(0,o.makeSearchPath)(t,p);if(![u.EXPLORE_TABS.HOMES,u.EXPLORE_TABS.EXPERIENCES].includes(f))return f===u.EXPLORE_TABS.ADVENTURES||f===u.EXPLORE_TABS.SELECT_HOMES?(_=decodeURIComponent((0,o.makeQueryStrings)(R,p)),`${O}${_}`):'/';if(s?.some((n=>'string'==typeof n&&n.startsWith('/playlists')))??!1)return'/';const P=s?.[0];if((0,o.isOnlineExperiences)(t,f??u.EXPLORE_TABS.HOMES)&&null!=R.refinement_paths&&'/experiences'!==P&&!(0,o.isOnlineExperiencesSearchRefinementPath)(t))return _=decodeURIComponent((0,o.makeQueryStrings)((0,h.default)(R,['refinement_paths']),p)),`${O}${_}`;if((0,o.isOnlineExperiences)(t,f??u.EXPLORE_TABS.HOMES)&&(null!=t.location||null!=t.query||null!=t.place_id))return _=decodeURIComponent((0,o.makeQueryStrings)((0,h.default)(R,['location','query','place_id']),p)),`${O}${_}`;return S(n.pathname)!==S(O)?`${O}${_}`:null}}),"0ef88a",["ba7a76","d69748","a27fc3","3d44ce","1b01f9","f4229b","87916a","a7c4ef","4ee5a9","1e300f","3d4f9e"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isP25=function(n){return null!=n.omni_page_id&&null!=n.dynamic_product_ids}}),"16c731",[]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return u.default.get('exploreTreatments')||[]};var u=t(r(d[1]))}),"23c701",["ba7a76","0a58da"]);
__d((function(g,r,i,a,m,e,d){"use strict";function t(n){return null==n?[]:Array.isArray(n)?n.flatMap(t):'string'==typeof n?[n]:[JSON.stringify(n)]}Object.defineProperty(e,"__esModule",{value:!0}),e.convertToRawParams=function(n){const s=[];return Object.keys(n).forEach((o=>{const u=t(n[o]);s.push({filterName:o,filterValues:u})})),s}}),"294886",[]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=s,e.replaceToHistory=function(t,n={}){s((0,o.getHistory)(),t,n)};var n=t(r(d[1])),o=r(d[2]);function s(t,o,{maintainScrollPosition:s=!1,maintainQueryParams:l=!1,maintainHash:u=!1,params:c,state:f}={}){const p=(0,n.default)(o,{maintainQueryParams:l,maintainHash:u,params:c});t.replace(p,f),g.window&&!s&&g.window.scrollTo(0,0)}}),"4ee5a9",["ba7a76","be6a20","7934b6"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t=[]){const u=t.map((({treatmentFlag:t})=>t)).filter(n.default).flat(1);return[...new Set(u)]};var n=t(r(d[1]))}),"6e1627",["ba7a76","f30bc0"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.manageTreatmentFlagsWithUpfrontPricingFlag=function(t){let n=t;const o=!!u.default.current().enable_upfront_pricing;o||(n=t.filter((t=>t!==E)));o&&!t.includes(E)&&(n=[...t,E]);return n.filter(I.default)},e.maybeRemoveUpfrontPricingParamsFromUrl=function(){requestIdleCallback((()=>{const t=u.default.current().enable_upfront_pricing;void 0!==t&&(0,p.airdogCount)('search.upfront_pricing.access_with_cookie',1,`value: ${t}`)}));(0,l.default)()[w]&&(0,f.getHistory)().replace(C())},e.setEnableUpfrontPricing=async function(t){return await(s.default.getBootstrap('api_web_client_migration.fejax.enabled')&&!s.default.getBootstrap('api_web_client_migration.fejax.pricing_guest.kill_switch')?(0,h().logMigration)(b().default.get("/_/core-guest-loop/upfront-pricing",{searchParams:{enable_upfront_pricing:t?'true':'false'}}),{method:'GET',client:'niobe',migrationId:'pricing_guest',group:'fejax'}):(0,h().logMigration)(c.default.ajax("/_/core-guest-loop/upfront-pricing?enable_upfront_pricing="+(t?'true':'false'),{dataType:'json',processResponse:!1}),{method:'GET',client:'fejax',migrationId:'pricing_guest',group:'fejax'})),u.default.setCurrent({...u.default.current(),enable_upfront_pricing:t}),Promise.resolve()},e.shouldShowUpfrontPricingBanner=function(){if(s.default.getBootstrap('pricing_upfront_pricing_2022_toggle_killswitch'))return!1;if(T())return!1;return!0};var n=t(r(d[1])),o=r(d[2]),u=t(r(d[3])),c=t(r(d[4])),l=t(r(d[5])),f=r(d[6]),s=t(r(d[7])),p=r(d[8]),_=r(d[9]);function b(){const n=t(r(d[10]));return b=function(){return n},n}function h(){const t=r(d[11]);return h=function(){return t},t}var I=t(r(d[12]));const w='enable_upfront_pricing',E='upfront_pricing_enabled',P=['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE','GB','IS','LI','NO','AU','KR','CH','HU','CA','IL','CN','NZ'];function C(){const t=(0,l.default)(),{pathname:n,hash:u}=window.location,c={...t};delete c[w];return`${n}?${(0,o.stringify)(c)}${u}`}function T(){return!!(P.includes(n.default.country())||P.includes(n.default.tld_country())||(0,_.isInChinaFlow)())}}),"74d137",["ba7a76","862e50","e950a3","06a99e","c3984f","a7c4ef","7934b6","c235f8","3e4681","b7eb08","69a7c4","7c530a","f30bc0"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.logMigration=function(t,c){return Promise.resolve(t).then((()=>u({...c,result:'success'}))).catch((t=>{u({...c,result:'error',responseStatus:t?.status,noError:!t}),o.default.getBootstrap('niobe.rest.error_logging.kill_switch')||!t||t.status&&200!==t.status||((0,s.airdogCount)('rest_migration.debug',1,{...c,responseStatus:t.status,responseStatusText:t.statusText,message:t.message||'',name:t.name||''}),(0,n().reportNiobeError)(t,{fingerprint:['niobe'],tags:{...c}}))})).catch((()=>{})),t};var s=r(d[1]),o=t(r(d[2]));function n(){const t=r(d[3]);return n=function(){return t},t}function u(t){(0,s.airdogCount)('rest_migration.request',1,t)}}),"7c530a",["ba7a76","3e4681","c235f8","8e002d"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.clearGlobalRehydrationCache=function(){const t=o();t.searchResults=null,t.mapSearchResults=null},e.getGlobalRehydrationCache=o,e.getRehydratableListingIds=function({searchResults:t,mapSearchResults:s}){if(!(null!=t&&0!==t?.length||null!=s&&0!==s?.length))return u;const l=new Set,c=[...t||[],...s||[]]?.map((t=>('ExploreSplitStaysListingItem'===t.__typename&&t?.splitStaysListings?.forEach((t=>{null!=t?.id&&l.add(t.id)})),'SkinnyListingItem'===t?.__typename?t.listingId:'StaySearchResult'===t?.__typename?t.listing?.id:null))).filter(n.default),o=new Set(c);return l.forEach((t=>o.delete(t))),Array.from(o)},e.getVariablesWithoutRehydrationIDs=function(t){if(null==t)return;const s={...t,staysSearchRequest:{...t.staysSearchRequest},staysMapSearchRequestV2:{...t.staysMapSearchRequestV2}};return delete s?.staysSearchRequest?.skipHydrationListingIds,delete s?.staysMapSearchRequestV2?.skipHydrationListingIds,s},e.rehydrateFeedSearchResults=function({searchResultsContainingSkinnyListings:t,previousSearchResults:s,previousMapSearchResults:u}){let c=!0;const o=h(s,u),y=t?.map((t=>{if('SkinnyListingItem'===t.__typename){if(null==t.listingId)return null;const s=o.get(t.listingId);return null==s?(c=!1,null):s}return t})).filter(n.default);c||(0,l.reportError)(new Error('StaysSearchRoute.rehydrateFeedSearchResults: Could not rehydrate all search results. '));return y},e.rehydrateMapSearchResults=function({mapSearchResultsContainingSkinnyListings:t,previousSearchResults:s,previousMapSearchResults:u}){let c=!0;const o=h(s,u),y=t?.map((t=>{if('SkinnyListingItem'===t.__typename){if(null==t.listingId)return null;const s=o.get(t.listingId);return null==s?(c=!1,null):s}return t})).filter(n.default)||null;c||(0,l.reportError)(new Error('StaysSearchRoute.rehydrateMapSearchResults: Could not rehydrate all search results. '));return y};var s=t(r(d[1])),n=t(r(d[2])),l=r(d[3]);const u=[],c='stays_search_rehydration_cache';function o(){return s.default.setIfMissingThenGet(c,(()=>({searchResults:null,mapSearchResults:null})))}function h(t,s){const n=new Map;return[...t||[],...s||[]].forEach((t=>{'StaySearchResult'===t?.__typename&&null!=t.listing?.id&&n.set(t.listing?.id,t)})),n}}),"926f8b",["ba7a76","29c0a5","f30bc0","f2f40f"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,n=(0,u.default)()){return n.find((({experiment:u})=>u===t))};var u=t(r(d[1]))}),"9439c5",["ba7a76","23c701"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.STAYS_SEARCH_FILTER_KEYS=e.KNOWN_SEARCH_QUERY_PARAMS=void 0;const _=['cursor','autosuggestions_options','max_categories','metadata_only','satori_version','search_type','source','treatment_flags','raw_params'];e.STAYS_SEARCH_FILTER_KEYS=_;const t=[..._,'inst','niobe_test_destinations','zoom'];e.KNOWN_SEARCH_QUERY_PARAMS=t}),"977a9f",[]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c=t(r(d[1]));var u={document:void 0,getDocument:()=>r(d[3])(d[2]).then(c.default).then((t=>t.default)),name:'StaysSearch',type:'query',operationId:'d4d9503616dc72ab220ed8dcf17f166816dccb2593e7b4625c91c3fce3a3b3d6'};e.default=u}),"a06569",["ba7a76","45f788","68b1a1","c592d7"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function({location:t,cookie:T,loadQuery:v,exploreTreatments:S,getRenderingState:b,customPrepareNiobeData:k,getErf:O,previousPrepareProps:E}){const{deviceUsagePreferences:C,isBotRequest:D,formFactor:M=n.DEFAULT_FORM_FACTOR}=k||{},{isReduceNetworkDataEnabled:P}=C||{},I=(0,o.createTaskController)(),x=(0,c.default)(t.search),A=null==x.search_type||x.search_type===f.SearchType.USER_MAP_MOVE&&null!=E;A&&(0,l.default)({experimentName:M===n.FORM_FACTOR.WIDE?p:F,exploreTreatments:S,renderingState:b(),getErfServer:O});const U=(0,y.default)(S),q=U?.includes(M===n.FORM_FACTOR.WIDE?s.staysSearchRehydrationDesktopTreatmentFlag:s.staysSearchRehydrationMoWebTreatmentFlag),w=E?.queryRef?.result?.data?.presentation?.staysSearch?.results?.categoryBar?.categoryBarCacheId,B=(0,_.default)({categoryBarCacheId:w,cookie:T,exploreTreatments:S,getRenderingState:b,location:t,formFactor:M,isReduceNetworkDataEnabled:P,previousListingIds:q&&A?(0,h.getRehydratableListingIds)((0,h.getGlobalRehydrationCache)()):void 0}),N=(0,u.getRedirectUrl)(t);let L=!1;D||(L=!0);return{queryRef:v({context:{fetchOptions:{signal:I?.signal},taskController:I},variables:B,query:R.default,deferrable:L,usePOSTForQuery:!0,skip:null!=N}),showDeferredSkeleton:L,redirectUrl:N}};var o=r(d[1]),s=r(d[2]),n=r(d[3]),l=t(r(d[4])),c=t(r(d[5])),u=r(d[6]),y=t(r(d[7])),f=r(d[8]),h=r(d[9]),_=t(r(d[10])),R=t(r(d[11]));const p='stays_search_rehydration_desktop_v6',F='stays_search_rehydration_moweb_v6'}),"a829bd",["ba7a76","a2c93f","dc5d1d","b679e8","d271b5","a7c4ef","0ef88a","6e1627","6660fd","926f8b","a8e410","a06569"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default,n=r(d[1]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function({categoryBarCacheId:t,exploreTreatments:n,location:F,formFactor:T,isReduceNetworkDataEnabled:h,previousListingIds:P}){const M=(0,s.default)(F.search),{mock:S}=M,k=T===c.FORM_FACTOR.COMPACT,x=!(0,f.isP25)(M),y=E(n),A=[...x?_.P2_MAP_FEED_DECOUPLING_TREATMENT_FLAGS:[],...(0,o.default)(y)];if(S)return{mockIdentifier:`ExplorePresentation/${S}`,includeMapResults:x,isLeanTreatment:(0,p.getExploreIsLeanTreatmentFlag)()};let I=(0,l.selectFiltersForRequest)({location:F,cdnCacheSafe:!1,cdnExperiments:void 0,treatmentFlags:(0,u.manageTreatmentFlagsWithUpfrontPricingFlag)(A),isPWA:k,isReduceNetworkDataEnabled:h});t&&['category_change','filter_change'].includes(I.searchType||'')&&(I={...I,categoryBarCacheId:t});const C=P&&P?.length>0?P:void 0,q=(0,R.default)({location:F,requestedPageType:'STAYS_SEARCH',exploreRequest:I,skipHydrationListingIds:C,isReduceNetworkDataEnabled:h,maxMapItems:(0,R.getMaxMapItems)({isReduceNetworkDataEnabled:h})}),L=(0,l.selectFiltersForRequest)({location:F,cdnCacheSafe:!1,cdnExperiments:void 0,treatmentFlags:(0,u.manageTreatmentFlagsWithUpfrontPricingFlag)(A),isPWA:k,isMapRequest:!0,isReduceNetworkDataEnabled:h}),b=(0,R.default)({location:F,requestedPageType:'STAYS_SEARCH',exploreRequest:L,skipHydrationListingIds:C,isReduceNetworkDataEnabled:h});return{staysSearchRequest:q,...x&&{staysMapSearchRequestV2:b},includeMapResults:x,isLeanTreatment:(0,p.getExploreIsLeanTreatmentFlag)()}};var s=n(r(d[2])),o=n(r(d[3])),l=r(d[4]),c=r(d[5]),u=r(d[6]),p=r(d[7]),f=r(d[8]),_=r(d[9]),R=t(r(d[10]));function E(t){const n=new Set(['feed_map_decouple_homepage_desktop','feed_map_decouple_homepage_moweb']);return t?.filter((({experiment:t})=>!n.has(t)))}}),"a8e410",["45f788","ba7a76","a7c4ef","6e1627","3d44ce","b679e8","74d137","0d1817","16c731","f36c5b","e16093"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function({experimentName:t,exploreTreatments:u,renderingState:o,getErfServer:f}){const{treatmentName:s,log:c}=(0,l.default)(t,u)||{};s&&'manual'===c&&('server-render'===o?f(t):'client-render'===o&&n.default.logCustomHashing(t,s))};var n=t(r(d[1])),l=t(r(d[2]))}),"d271b5",["ba7a76","fc0842","9439c5"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.staysSearchRehydrationMoWebTreatmentFlag=e.staysSearchRehydrationDesktopTreatmentFlag=void 0;e.staysSearchRehydrationMoWebTreatmentFlag='stays_search_rehydration_treatment_moweb';e.staysSearchRehydrationDesktopTreatmentFlag='stays_search_rehydration_treatment_desktop'}),"dc5d1d",[]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default,n=r(d[1]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.getMaxMapItems=function({isReduceNetworkDataEnabled:t}){return t?8:9999},e.getRawParamSingleValue=function(t,n){return N(t,n)?.[0]??null},e.merge=function(t,n,l){const{rawParams:s,...o}=t,{rawParams:c,...f}=n,p=new Set(Object.keys(l||{}).map(u.default)),R={};s?.forEach((({filterName:t,filterValues:n})=>{t&&!p.has(t)&&(R[t]=n)})),c?.forEach((({filterName:t,filterValues:n})=>{t&&(R[t]=n)}));const y=w(Object.entries(R).map((([t,n])=>({filterName:t,filterValues:n}))));return{...o,...f,rawParams:y}},e.selectFiltersFromURL=E,e.selectSearchFiltersForRequest=P;var l=n(r(d[2])),u=t(r(d[3])),s=t(r(d[4])),o=n(r(d[5])),c=r(d[6]),f=n(r(d[7])),p=r(d[8]),R=r(d[9]),y=r(d[10]);function S(t,n){return(0,u.snakeKeysToCamelKeys)((0,l.default)((0,s.coerceCorrectTypes)(t,{forRequest:!0}),n))}function _(t){return(0,l.default)((0,f.default)(t),y.KNOWN_SEARCH_QUERY_PARAMS)}function E({queryString:t}){const n={..._(t)};return{...(0,s.default)({...n})}}function N(t,n){if(null!=t){const l=t.find((t=>t?.filterName===n));if(null!=l?.filterValues&&l.filterValues.length>0)return l.filterValues}return null}function w(t){const n=[...t];return n.sort(((t,n)=>(t?.filterName??'').localeCompare(n?.filterName??''))),n}function P({location:t,exploreRequest:n,filterKeys:s,isReduceNetworkDataEnabled:f=!1}){const R=(0,o.default)(n,...s.map(u.default)),y=E({queryString:t?.search}),_=(0,l.default)((0,c.camelKeysToSnakeKeys)(n),s);return{...S({...y.cursor&&{cursor:y.cursor},...f&&{max_categories:8},..._,raw_params:w((0,p.convertToRawParams)(R))},s)}}var T=function({location:t,exploreRequest:n,requestedPageType:l,isReduceNetworkDataEnabled:u=!1,skipHydrationListingIds:s,maxMapItems:o}){const c={requestedPageType:l,...P({location:t,exploreRequest:n,filterKeys:y.STAYS_SEARCH_FILTER_KEYS,isReduceNetworkDataEnabled:u}),...null!=o&&{maxMapItems:o}};return c.searchType===R.SearchType.USER_MAP_MOVE&&s?.length?{...c,skipHydrationListingIds:s}:c};e.default=T}),"e16093",["45f788","ba7a76","45db44","fd0757","c6fd31","3d4f9e","2755ca","a7c4ef","294886","6660fd","977a9f"]);
__d((function(g,r,i,a,m,e,d){"use strict";var _;Object.defineProperty(e,"__esModule",{value:!0}),e.P2_MAP_FEED_DECOUPLING_TREATMENT_FLAGS=e.HOMEPAGE_MAP_FEED_DECOUPLING_TREATMENT_FLAGS=void 0,(function(_){_.M2="decompose_stays_search_m2_treatment",_.M3="decompose_stays_search_m3_treatment",_.M3_5="decompose_stays_search_m3_5_treatment",_.M4="decompose_stays_search_m4_treatment",_.M5="decompose_experiences_search_m5_treatment",_.M9="decompose_filters_treatment",_.CLEANUP="decompose_schema_cleanup"})(_||(_={}));_.M4,_.M2,_.M3,_.M3_5,_.M5,_.M3,_.M2,_.M3,_.M3_5,_.M4,_.M5,_.M9,_.CLEANUP;e.P2_MAP_FEED_DECOUPLING_TREATMENT_FLAGS=['feed_map_decouple_m11_treatment'];e.HOMEPAGE_MAP_FEED_DECOUPLING_TREATMENT_FLAGS=['feed_map_decouple_homepage_treatment']}),"f36c5b",[]);
//# sourceMappingURL=https://sourcemaps.d.musta.ch/airbnb/static/packages/web/common/frontend/stays-search/routes/StaysSearchRoute/StaysSearchRoute.prepare.a7f8db7d5a.js.map